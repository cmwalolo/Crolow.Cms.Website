@    using Crolow.Cms.Core.Controllers.Api.FormsManagement
@    using Crolow.Cms.Core.Models.ViewModel;
@    using Crolow.Cms.Core.Controllers.Api.BasketManagement;
    using Crolow.Cms.Core.Controllers.Api.CrolowForm;
@inject Umbraco.Cms.Core.UmbracoApiControllerTypeCollection _controllers;
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<GridFormModel>;
@{
    var apiUrl = Url.GetUmbracoApiService<CrolowFormApiController>(_controllers, "InsertComment");
}}

<section>
    <div class="container">
        <div class="row mt-4">
            <div class="col-12">
                <form id="form1">
                    <input type="hidden" name="BlogPostUmbracoId" value="@Model.Id" />
                    <input type="hidden" name="Website" value="" />
                    <div class="col-12 form-group">
                        <h4>Laissez un commentaire</h4>
                        <label for="message">Message</label>
                        <textarea name="message" id="message" msg cols="30" rows="5" class="form-control" style="background-color: black;"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="name">Votre nom</label>
                        <input type="text" name="name" id="fullname" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="text" name="email" id="email" class="form-control">
                    </div>
                    <div class="form-inline">
                        <input type="checkbox" name="subscribe" id="checkbx" class="mr-1">
                        <label for="subscribe">Subscribe me to the newlettter</label>
                    </div>
                    <div class="form-group">
                        <button type="button" onclick="handleFormSubmit(this)" id="post" class="btn">
                            <span class="bi-send bi-large" aria-hidden="true"></span>
                            Postez le commentaire
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>
<script type="text/javascript">
    // Example POST method implementation:
    async function postData(url = "", data = {}) {
        // Default options are marked with *
        const response = await fetch(url, {
            method: "POST", // *GET, POST, PUT, DELETE, etc.
            mode: "cors", // no-cors, *cors, same-origin
            cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
            credentials: "same-origin", // include, *same-origin, omit
            headers: {
                "Content-Type": "application/json",
            },
            redirect: "follow", // manual, *follow, error
            referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
            body: JSON.stringify(data), // body data type must match "Content-Type" header
        });
        //return await response.json(); // parses JSON response into native JavaScript objects
    }

    document.addEventListener("DOMContentLoaded", () => {
        form = document.getElementById('form1');
        form.removeEventListener('submit', handleFormSubmit, true);
        form.addEventListener('submit', handleFormSubmit);
    });

    function handleFormSubmit(element) {
        $(element).attr("disabled", true);
        var data =
        {
            BlogPostUmbracoId: document.getElementsByName('BlogPostUmbracoId')[0].value,
            Name: document.getElementsByName('name')[0].value,
            Message: document.getElementsByName('message')[0].value,
            Email: document.getElementsByName('email')[0].value,
            Website: "crolow.pix",
            Application: "MediaComment"

        }

        postData("@apiUrl", data);
        return false;
    }
</script>
